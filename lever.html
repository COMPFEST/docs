<h1 id="quantum-backend-documentation">Quantum Backend Documentation</h1>
<h2 id="environments">Environments</h2>
<h3 id="production">Production</h3>
<ul>
<li><strong>URL:</strong> <code>https://quantum.compfest.id</code></li>
<li><strong>Secret:</strong> — <em>(To be provided)</em></li>
</ul>
<h3 id="development">Development</h3>
<ul>
<li><strong>URL:</strong> <code>https://quantum-games-dev.fly.dev</code></li>
<li><strong>Secret:</strong> <code>oqtZiTK6y1S8IwmbBMWHtw==</code> <em>(Ensure this is kept secure)</em></li>
</ul>
<hr>
<h2 id="game-build-settings-unity">Game Build Settings (Unity)</h2>
<ul>
<li><strong>Platform:</strong> WebGL</li>
<li><strong>Player Settings:</strong>
<ul>
<li>Default Canvas Width: <code>310</code></li>
<li>Default Canvas Height: <code>570</code></li>
</ul>
</li>
</ul>
<hr>
<h2 id="request-headers">Request Headers</h2>
<p>These headers are required for authenticated requests to the backend endpoints (<code>/auth</code>, <code>/point</code>).</p>
<h3 id="x-signature"><code>X-Signature</code></h3>
<ul>
<li>
<p><strong>Description:</strong> Signature to protect requests between the game and backend. Generated using HMACSHA512 based on the request body, timestamp, endpoint path, and the environment's secret key.</p>
</li>
<li>
<p><strong>Generation Logic:</strong></p>
<ol>
<li>Compute the SHA256 hash of the raw JSON request body bytes.</li>
<li>Convert the hash to a lowercase hexadecimal string.</li>
<li>Create the signature base string: <code>"{HTTP_METHOD}:{ENDPOINT_PATH}:{HEX_HASH}:{TIMESTAMP}"</code>.
<ul>
<li>Example for <code>/auth</code>: <code>"POST:/auth:a1b2c3d4...:2023-10-27T10:00:00Z"</code></li>
<li>Example for <code>/point</code>: <code>"POST:/point:e5f6g7h8...:2023-10-27T10:05:00Z"</code></li>
</ul>
</li>
<li>Compute the HMACSHA512 hash of the signature base string using the environment's <strong>Secret</strong> key (UTF8 encoded).</li>
<li>Encode the resulting HMAC hash as a Base64 string. This is the value for the <code>X-Signature</code> header.</li>
</ol>
</li>
<li>
<p><strong>Code Examples:</strong></p>
<ul>
<li>
<p><strong>C# / Unity C# / Godot C#</strong></p>
<pre><pre><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using System;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using System.Security.Cryptography;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using System.Text;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>// Ensure you have a variable 'SignatureSecret' holding the correct environment secret.</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>// e.g., private const string SignatureSecret = "oqtZiTK6y1S8IwmbBMWHtw=="; // For Dev</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>public static string GenerateSignature(byte[] body, string timestamp, string endpointPath /* e.g., "/auth" or "/point" */)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>{</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    byte[] hashBody;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    using (SHA256 sha256 = SHA256.Create())</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        hashBody = sha256.ComputeHash(body);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    // Ensure BitConverter output is consistently lower-case hex</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    string hexHash = BitConverter.ToString(hashBody).Replace("-", "").ToLowerInvariant();</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    string signatureBase = $"POST:{endpointPath}:{hexHash}:{timestamp}";</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    using (var hmac = new HMACSHA512(Encoding.UTF8.GetBytes(SignatureSecret)))</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        byte[] signatureBytes = hmac.ComputeHash(Encoding.UTF8.GetBytes(signatureBase));</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        return Convert.ToBase64String(signatureBytes);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>}</span></div></pre></pre>
</li>
<li>
<p><strong>Javascript (Example for Postman)</strong></p>
<pre><pre><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="color: rgb(92, 99, 112);">// Postman Pre-request Script Example</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(198, 120, 221);">const</span><span> crypto </span><span style="color: rgb(97, 175, 239);">=</span><span> </span><span style="color: rgb(97, 175, 239);">require</span><span style="color: rgb(171, 178, 191);">(</span><span style="color: rgb(152, 195, 121);">'crypto-js'</span><span style="color: rgb(171, 178, 191);">)</span><span style="color: rgb(171, 178, 191);">;</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(92, 99, 112);">// Set the secret key in Postman environment variables</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(198, 120, 221);">const</span><span> secretKey </span><span style="color: rgb(97, 175, 239);">=</span><span> pm</span><span style="color: rgb(171, 178, 191);">.</span><span>environment</span><span style="color: rgb(171, 178, 191);">.</span><span style="color: rgb(97, 175, 239);">get</span><span style="color: rgb(171, 178, 191);">(</span><span style="color: rgb(152, 195, 121);">"apiSecret"</span><span style="color: rgb(171, 178, 191);">)</span><span style="color: rgb(171, 178, 191);">;</span><span> </span><span style="color: rgb(92, 99, 112);">// e.g., "oqtZiTK6y1S8IwmbBMWHtw=="</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(198, 120, 221);">const</span><span> timeStamp </span><span style="color: rgb(97, 175, 239);">=</span><span> </span><span style="color: rgb(198, 120, 221);">new</span><span> </span><span style="color: rgb(209, 154, 102);">Date</span><span style="color: rgb(171, 178, 191);">(</span><span style="color: rgb(171, 178, 191);">)</span><span style="color: rgb(171, 178, 191);">.</span><span style="color: rgb(97, 175, 239);">toISOString</span><span style="color: rgb(171, 178, 191);">(</span><span style="color: rgb(171, 178, 191);">)</span><span style="color: rgb(171, 178, 191);">;</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>pm</span><span style="color: rgb(171, 178, 191);">.</span><span>request</span><span style="color: rgb(171, 178, 191);">.</span><span>headers</span><span style="color: rgb(171, 178, 191);">.</span><span style="color: rgb(97, 175, 239);">upsert</span><span style="color: rgb(171, 178, 191);">(</span><span style="color: rgb(171, 178, 191);">{</span><span> </span><span style="color: rgb(224, 108, 117);">key</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(152, 195, 121);">"X-Timestamp"</span><span style="color: rgb(171, 178, 191);">,</span><span> </span><span style="color: rgb(224, 108, 117);">value</span><span style="color: rgb(97, 175, 239);">:</span><span> timeStamp </span><span style="color: rgb(171, 178, 191);">}</span><span style="color: rgb(171, 178, 191);">)</span><span style="color: rgb(171, 178, 191);">;</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(92, 99, 112);">// Ensure body is raw JSON and properly stringified without extra whitespace</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(198, 120, 221);">const</span><span> rawBody </span><span style="color: rgb(97, 175, 239);">=</span><span> pm</span><span style="color: rgb(171, 178, 191);">.</span><span>request</span><span style="color: rgb(171, 178, 191);">.</span><span>body</span><span> </span><span style="color: rgb(97, 175, 239);">?</span><span> pm</span><span style="color: rgb(171, 178, 191);">.</span><span>request</span><span style="color: rgb(171, 178, 191);">.</span><span>body</span><span style="color: rgb(171, 178, 191);">.</span><span>raw</span><span style="color: rgb(171, 178, 191);">.</span><span style="color: rgb(97, 175, 239);">trim</span><span style="color: rgb(171, 178, 191);">(</span><span style="color: rgb(171, 178, 191);">)</span><span> </span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(152, 195, 121);">""</span><span style="color: rgb(171, 178, 191);">;</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(198, 120, 221);">let</span><span> bodyToHash </span><span style="color: rgb(97, 175, 239);">=</span><span> </span><span style="color: rgb(152, 195, 121);">""</span><span style="color: rgb(171, 178, 191);">;</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(198, 120, 221);">if</span><span> </span><span style="color: rgb(171, 178, 191);">(</span><span>rawBody</span><span style="color: rgb(171, 178, 191);">)</span><span> </span><span style="color: rgb(171, 178, 191);">{</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>   </span><span style="color: rgb(198, 120, 221);">try</span><span> </span><span style="color: rgb(171, 178, 191);">{</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>     </span><span style="color: rgb(92, 99, 112);">// Parse and restringify to ensure canonical format if needed</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>     </span><span style="color: rgb(198, 120, 221);">const</span><span> jsonBody </span><span style="color: rgb(97, 175, 239);">=</span><span> </span><span style="color: rgb(209, 154, 102);">JSON</span><span style="color: rgb(171, 178, 191);">.</span><span style="color: rgb(97, 175, 239);">parse</span><span style="color: rgb(171, 178, 191);">(</span><span>rawBody</span><span style="color: rgb(171, 178, 191);">)</span><span style="color: rgb(171, 178, 191);">;</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>     bodyToHash </span><span style="color: rgb(97, 175, 239);">=</span><span> </span><span style="color: rgb(209, 154, 102);">JSON</span><span style="color: rgb(171, 178, 191);">.</span><span style="color: rgb(97, 175, 239);">stringify</span><span style="color: rgb(171, 178, 191);">(</span><span>jsonBody</span><span style="color: rgb(171, 178, 191);">)</span><span style="color: rgb(171, 178, 191);">;</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>   </span><span style="color: rgb(171, 178, 191);">}</span><span> </span><span style="color: rgb(198, 120, 221);">catch</span><span> </span><span style="color: rgb(171, 178, 191);">(</span><span>e</span><span style="color: rgb(171, 178, 191);">)</span><span> </span><span style="color: rgb(171, 178, 191);">{</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>     bodyToHash </span><span style="color: rgb(97, 175, 239);">=</span><span> rawBody</span><span style="color: rgb(171, 178, 191);">;</span><span> </span><span style="color: rgb(92, 99, 112);">// Fallback to rawBody if not JSON</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>   </span><span style="color: rgb(171, 178, 191);">}</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(171, 178, 191);">}</span><span> </span><span style="color: rgb(198, 120, 221);">else</span><span> </span><span style="color: rgb(171, 178, 191);">{</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>   bodyToHash </span><span style="color: rgb(97, 175, 239);">=</span><span> </span><span style="color: rgb(152, 195, 121);">""</span><span style="color: rgb(171, 178, 191);">;</span><span> </span><span style="color: rgb(92, 99, 112);">// Handle empty body</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(171, 178, 191);">}</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(92, 99, 112);">// Calculate SHA256 hash of the body</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(198, 120, 221);">const</span><span> hashedBody </span><span style="color: rgb(97, 175, 239);">=</span><span> crypto</span><span style="color: rgb(171, 178, 191);">.</span><span style="color: rgb(209, 154, 102);">SHA256</span><span style="color: rgb(171, 178, 191);">(</span><span>bodyToHash</span><span style="color: rgb(171, 178, 191);">)</span><span style="color: rgb(171, 178, 191);">.</span><span style="color: rgb(97, 175, 239);">toString</span><span style="color: rgb(171, 178, 191);">(</span><span>crypto</span><span style="color: rgb(171, 178, 191);">.</span><span>enc</span><span style="color: rgb(171, 178, 191);">.</span><span style="color: rgb(209, 154, 102);">Hex</span><span style="color: rgb(171, 178, 191);">)</span><span style="color: rgb(171, 178, 191);">;</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(92, 99, 112);">// Construct the signature base string</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(92, 99, 112);">// Ensure the path matches the endpoint exactly (e.g., "/auth")</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(198, 120, 221);">const</span><span> endpointPath </span><span style="color: rgb(97, 175, 239);">=</span><span> pm</span><span style="color: rgb(171, 178, 191);">.</span><span>request</span><span style="color: rgb(171, 178, 191);">.</span><span>url</span><span style="color: rgb(171, 178, 191);">.</span><span style="color: rgb(97, 175, 239);">getPath</span><span style="color: rgb(171, 178, 191);">(</span><span style="color: rgb(171, 178, 191);">)</span><span style="color: rgb(171, 178, 191);">;</span><span> </span><span style="color: rgb(92, 99, 112);">// Adjust if necessary (e.g., ensure leading slash)</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(198, 120, 221);">const</span><span> signatureString </span><span style="color: rgb(97, 175, 239);">=</span><span> </span><span style="color: rgb(152, 195, 121);">`</span><span style="color: rgb(171, 178, 191);">${</span><span>pm</span><span style="color: rgb(171, 178, 191);">.</span><span>request</span><span style="color: rgb(171, 178, 191);">.</span><span>method</span><span style="color: rgb(171, 178, 191);">}</span><span style="color: rgb(152, 195, 121);">:</span><span style="color: rgb(171, 178, 191);">${</span><span>endpointPath</span><span style="color: rgb(171, 178, 191);">}</span><span style="color: rgb(152, 195, 121);">:</span><span style="color: rgb(171, 178, 191);">${</span><span>hashedBody</span><span style="color: rgb(171, 178, 191);">}</span><span style="color: rgb(152, 195, 121);">:</span><span style="color: rgb(171, 178, 191);">${</span><span>timeStamp</span><span style="color: rgb(171, 178, 191);">}</span><span style="color: rgb(152, 195, 121);">`</span><span style="color: rgb(171, 178, 191);">;</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(209, 154, 102);">console</span><span style="color: rgb(171, 178, 191);">.</span><span style="color: rgb(97, 175, 239);">log</span><span style="color: rgb(171, 178, 191);">(</span><span style="color: rgb(152, 195, 121);">"Signature Base:"</span><span style="color: rgb(171, 178, 191);">,</span><span> signatureString</span><span style="color: rgb(171, 178, 191);">)</span><span style="color: rgb(171, 178, 191);">;</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(92, 99, 112);">// Calculate HMACSHA512 signature</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(198, 120, 221);">const</span><span> signature </span><span style="color: rgb(97, 175, 239);">=</span><span> crypto</span><span style="color: rgb(171, 178, 191);">.</span><span style="color: rgb(209, 154, 102);">HmacSHA512</span><span style="color: rgb(171, 178, 191);">(</span><span>signatureString</span><span style="color: rgb(171, 178, 191);">,</span><span> secretKey</span><span style="color: rgb(171, 178, 191);">)</span><span style="color: rgb(171, 178, 191);">.</span><span style="color: rgb(97, 175, 239);">toString</span><span style="color: rgb(171, 178, 191);">(</span><span>crypto</span><span style="color: rgb(171, 178, 191);">.</span><span>enc</span><span style="color: rgb(171, 178, 191);">.</span><span style="color: rgb(209, 154, 102);">Base64</span><span style="color: rgb(171, 178, 191);">)</span><span style="color: rgb(171, 178, 191);">;</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(209, 154, 102);">console</span><span style="color: rgb(171, 178, 191);">.</span><span style="color: rgb(97, 175, 239);">log</span><span style="color: rgb(171, 178, 191);">(</span><span style="color: rgb(152, 195, 121);">"Calculated Signature:"</span><span style="color: rgb(171, 178, 191);">,</span><span> signature</span><span style="color: rgb(171, 178, 191);">)</span><span style="color: rgb(171, 178, 191);">;</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(92, 99, 112);">// Add the signature header</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>pm</span><span style="color: rgb(171, 178, 191);">.</span><span>request</span><span style="color: rgb(171, 178, 191);">.</span><span>headers</span><span style="color: rgb(171, 178, 191);">.</span><span style="color: rgb(97, 175, 239);">upsert</span><span style="color: rgb(171, 178, 191);">(</span><span style="color: rgb(171, 178, 191);">{</span><span> </span><span style="color: rgb(224, 108, 117);">key</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(152, 195, 121);">"X-Signature"</span><span style="color: rgb(171, 178, 191);">,</span><span> </span><span style="color: rgb(224, 108, 117);">value</span><span style="color: rgb(97, 175, 239);">:</span><span> signature </span><span style="color: rgb(171, 178, 191);">}</span><span style="color: rgb(171, 178, 191);">)</span><span style="color: rgb(171, 178, 191);">;</span></div></pre></pre>
</li>
</ul>
</li>
</ul>
<h3 id="x-timestamp"><code>X-Timestamp</code></h3>
<ul>
<li>
<p><strong>Description:</strong> The UTC timestamp when the signature was generated, in ISO 8601 format (<code>yyyy-MM-ddTHH:mm:ssZ</code>). This <strong>must</strong> exactly match the timestamp used in the <code>X-Signature</code> calculation for the request to be valid.</p>
</li>
<li>
<p><strong>Code Examples:</strong></p>
<ul>
<li>
<p><strong>C# / Unity C# / Godot C#</strong></p>
<pre><pre><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>string timestamp = DateTime.UtcNow.ToString("yyyy-MM-ddTHH:mm:ssZ");</span></div></pre></pre>
</li>
<li>
<p><strong>Javascript</strong></p>
<pre><pre><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="color: rgb(198, 120, 221);">const</span><span> timestamp </span><span style="color: rgb(97, 175, 239);">=</span><span> </span><span style="color: rgb(198, 120, 221);">new</span><span> </span><span style="color: rgb(209, 154, 102);">Date</span><span style="color: rgb(171, 178, 191);">(</span><span style="color: rgb(171, 178, 191);">)</span><span style="color: rgb(171, 178, 191);">.</span><span style="color: rgb(97, 175, 239);">toISOString</span><span style="color: rgb(171, 178, 191);">(</span><span style="color: rgb(171, 178, 191);">)</span><span style="color: rgb(171, 178, 191);">;</span></div></pre></pre>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="api-endpoints">API Endpoints</h2>
<h3 id="post-auth---authenticate-user"><code>POST /auth</code> - Authenticate User</h3>
<p>Authenticates a user and arcade session using a unique code and an arcade identifier.</p>
<ul>
<li>
<p><strong>Headers:</strong></p>

























<table><thead><tr><th>Name</th><th>Content</th><th>Description</th></tr></thead><tbody><tr><td><code>X-Signature</code></td><td><em>Generated Signature</em></td><td>Signature generated for this request (see above)</td></tr><tr><td><code>X-Timestamp</code></td><td><em>Current Timestamp</em></td><td>Timestamp used for the signature (ISO 8601 UTC)</td></tr><tr><td><code>Content-Type</code></td><td><code>application/json</code></td><td>Specifies request body format</td></tr></tbody></table>
</li>
<li>
<p><strong>Request Body DTO (<code>ValidateCodeRequestDto</code>):</strong></p>
<ul>
<li><code>uniqueCode</code> (string): The unique code provided to the user.</li>
<li><code>arcadeCode</code> (string): Identifier for the specific game/arcade machine (e.g., <code>ARCADE_1</code>, <code>ARCADE_MOMENTUM</code>). This identifies which game context the unique code is being used for.</li>
</ul>
</li>
<li>
<p><strong>Request Body Example:</strong></p>
<pre><pre><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="color: rgb(171, 178, 191);">{</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"uniqueCode"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(152, 195, 121);">"user_provided_unique_code"</span><span style="color: rgb(171, 178, 191);">,</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"arcadeCode"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(152, 195, 121);">"ARCADE_1"</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(171, 178, 191);">}</span></div></pre></pre>
</li>
<li>
<p><strong>Responses:</strong></p>
<ul>
<li>
<p><strong><code>200 OK</code></strong> (Success)</p>
<pre><pre><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="color: rgb(171, 178, 191);">{</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"success"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(209, 154, 102);">true</span><span style="color: rgb(171, 178, 191);">,</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"message"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(152, 195, 121);">"Success authenticate"</span><span style="color: rgb(171, 178, 191);">,</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"data"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(171, 178, 191);">{</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        </span><span style="color: rgb(224, 108, 117);">"user"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(171, 178, 191);">{</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            </span><span style="color: rgb(224, 108, 117);">"userPlaygroundId"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(152, 195, 121);">"8bba8f9c-3058-4277-9e24-fc4b8f87efda"</span><span style="color: rgb(171, 178, 191);">,</span><span> </span><span style="color: rgb(92, 99, 112);">// ID for the user</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            </span><span style="color: rgb(224, 108, 117);">"username"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(152, 195, 121);">"hehoaaxx"</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        </span><span style="color: rgb(171, 178, 191);">}</span><span style="color: rgb(171, 178, 191);">,</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        </span><span style="color: rgb(224, 108, 117);">"attemptId"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(152, 195, 121);">"sV51FWd1vPHevFOHERV5N"</span><span> </span><span style="color: rgb(92, 99, 112);">// Unique ID for this specific authenticated game session/attempt</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(171, 178, 191);">}</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(171, 178, 191);">}</span></div></pre></pre>
<p><em>(Note: You will need the <code>userPlaygroundId</code> from the <code>data.user</code> object for the <code>/point</code> request.)</em></p>
</li>
<li>
<p><strong><code>400 Bad Request</code></strong> (Maximum attempts reached for the code, or code already used/invalid in context)</p>
<pre><pre><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="color: rgb(171, 178, 191);">{</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"success"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(209, 154, 102);">false</span><span style="color: rgb(171, 178, 191);">,</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"message"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(152, 195, 121);">"It looks like you've hit the maximum tries allowed or the code is invalid! No worries—just generate a new code to move forward."</span><span style="color: rgb(171, 178, 191);">,</span><span> </span><span style="color: rgb(92, 99, 112);">// Example message</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"data"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(198, 120, 221);">null</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(92, 99, 112);">// Potentially "error_code": "MAX_ATTEMPTS" or "INVALID_CODE"</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(171, 178, 191);">}</span></div></pre></pre>
<p><em>(Actual message and structure might vary based on backend implementation)</em></p>
</li>
<li>
<p><strong><code>401 Unauthorized</code></strong> (Invalid Headers)</p>
<pre><pre><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="color: rgb(171, 178, 191);">{</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"success"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(209, 154, 102);">false</span><span style="color: rgb(171, 178, 191);">,</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"message"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(152, 195, 121);">"Invalid Signature"</span><span> / </span><span style="color: rgb(152, 195, 121);">"Invalid timestamp"</span><span style="color: rgb(171, 178, 191);">,</span><span> </span><span style="color: rgb(92, 99, 112);">// Specific message may vary</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"data"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(198, 120, 221);">null</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(92, 99, 112);">// Potentially "error_code": "INVALID_SIGNATURE" or "INVALID_TIMESTAMP"</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(171, 178, 191);">}</span></div></pre></pre>
</li>
<li>
<p><strong><code>422 Unprocessable Entity</code></strong> (Invalid Request Body / Missing Fields)</p>
<pre><pre><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="color: rgb(171, 178, 191);">{</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"success"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(209, 154, 102);">false</span><span style="color: rgb(171, 178, 191);">,</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"message"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(152, 195, 121);">"Validation failed: uniqueCode should not be empty, arcadeCode should not be empty"</span><span style="color: rgb(171, 178, 191);">,</span><span> </span><span style="color: rgb(92, 99, 112);">// Example message</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"data"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(198, 120, 221);">null</span><span style="color: rgb(171, 178, 191);">,</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(92, 99, 112);">// Potentially "error_code": "VALIDATION_ERROR", "errors": { "uniqueCode": [...], "arcadeCode": [...] }</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(171, 178, 191);">}</span></div></pre></pre>
<p><em>(Will occur if <code>uniqueCode</code> or <code>arcadeCode</code> are missing or invalid based on DTO validation)</em></p>
</li>
</ul>
</li>
<li>
<p><strong>Signature Code Specifics (C# Example):</strong></p>
<pre><pre><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>// Use "/auth" as the endpointPath when calling GenerateSignature</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>// Ensure bodyRaw contains the JSON with both uniqueCode and arcadeCode</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>string signature = GenerateSignature(bodyRaw, timestamp, "/auth");</span></div></pre></pre>
</li>
<li>
<p><strong>Request/Response Classes (C# - Unity/Godot):</strong></p>
<pre><pre><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using System;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using System.Collections.Generic; // For potential error details</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>// Request DTO</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>[Serializable]</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>public class ValidateCodeRequestDto</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>{</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public string uniqueCode;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public string arcadeCode;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>}</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>// Success Response Structure (Root)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>[Serializable]</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>public class AuthSuccessResponse</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>{</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public bool success;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public string message;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public AuthResponseData data;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>}</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>// Data part of the Success Response</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>[Serializable]</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>public class AuthResponseData</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>{</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public UserData user;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public string attemptId;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>}</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>// User details within the data</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>[Serializable]</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>public class UserData</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>{</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public string userPlaygroundId;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public string username;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>}</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>// General Error Response Structure (Example)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>[Serializable]</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>public class ErrorResponse</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>{</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public bool success = false;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public string message;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public object data = null; // Typically null for errors</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public string error_code; // Optional: For specific error types</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public Dictionary&lt;string, List&lt;string&gt;&gt; errors; // Optional: For validation errors</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>}</span></div></pre></pre>
</li>
<li>
<p><strong>Request Example (Unity C# - <code>IEnumerator</code> - Updated):</strong></p>
<pre><pre><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using UnityEngine;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using UnityEngine.Networking;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using System.Collections;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using System.Text;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using System;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using UnityEngine.SceneManagement;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using TMPro;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>public class GameAuthenticator : MonoBehaviour // Renamed for clarity</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>{</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public TMP_Text textMessage;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public static string UserPlaygroundId { get; private set; } // Store the necessary ID</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    // attemptId might still be useful for logging/tracking, but not sent to /point</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public static string AttemptId { get; private set; }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    private const string DevApiUrl = "https://quantum-games-dev.fly.dev";</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    private const string SignatureSecret = "oqtZiTK6y1S8IwmbBMWHtw=="; // Dev Secret</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    // Call this with the user's code and the arcade's code</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public void StartAuthentication(string userCode, string arcadeIdentifier)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        StartCoroutine(AuthenticateUser(userCode, arcadeIdentifier));</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    IEnumerator AuthenticateUser(string userCode, string arcadeIdentifier)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        if (textMessage != null)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            textMessage.color = Color.black;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            textMessage.text = "Please wait... connecting to server";</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        string url = $"{DevApiUrl}/auth";</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        // Use the updated Request DTO</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        ValidateCodeRequestDto request = new() {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>             uniqueCode = userCode,</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>             arcadeCode = arcadeIdentifier</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        };</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        string requestBody = JsonUtility.ToJson(request);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        byte[] bodyRaw = Encoding.UTF8.GetBytes(requestBody);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        DateTime now = DateTime.UtcNow;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        string timestamp = now.ToString("yyyy-MM-ddTHH:mm:ssZ");</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        // Ensure GenerateSignature exists and uses the correct secret/logic</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        string signature = GenerateSignature(bodyRaw, timestamp, "/auth");</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        using (UnityWebRequest webRequest = new UnityWebRequest(url, "POST"))</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            webRequest.uploadHandler = new UploadHandlerRaw(bodyRaw);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            webRequest.downloadHandler = new DownloadHandlerBuffer();</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            webRequest.SetRequestHeader("Content-Type", "application/json");</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            // X-Gamecode removed</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            webRequest.SetRequestHeader("X-Timestamp", timestamp);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            webRequest.SetRequestHeader("X-Signature", signature);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            yield return webRequest.SendWebRequest();</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            if (webRequest.result == UnityWebRequest.Result.Success)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                // Parse the standardized success response</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                AuthSuccessResponse response = JsonUtility.FromJson&lt;AuthSuccessResponse&gt;(webRequest.downloadHandler.text);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                if (response != null &amp;&amp; response.success &amp;&amp; response.data != null &amp;&amp; response.data.user != null) {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                     if (textMessage != null)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                     {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                         textMessage.color = Color.black;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                         textMessage.text = response.message; // Display success message</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                     }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                     // Store credentials from the 'data' field</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                     UserPlaygroundId = response.data.user.userPlaygroundId;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                     AttemptId = response.data.attemptId; // Store if needed</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                     Debug.Log($"Authentication successful for {response.data.user.username}. User ID: {UserPlaygroundId}");</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                     SceneManager.LoadScene("GameScene"); // Load next scene</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                } else {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                     // Handle cases where parsing succeeded but response structure was unexpected</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                     HandleAuthError(webRequest, "Unexpected success response structure");</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            else</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                HandleAuthError(webRequest);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    // Helper to handle errors consistently</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    void HandleAuthError(UnityWebRequest webRequest, string defaultMessage = null) {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         string errorJson = webRequest.downloadHandler.text;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         string errorMessage = defaultMessage ?? $"Error {webRequest.responseCode}";</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         try {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>              // Try parsing the standard error format</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>              ErrorResponse error = JsonUtility.FromJson&lt;ErrorResponse&gt;(errorJson);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>              if (error != null &amp;&amp; !string.IsNullOrEmpty(error.message)) {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                   errorMessage = error.message;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>              }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         } catch {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>             Debug.LogError($"Raw Error Response: {errorJson}");</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         if (textMessage != null)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>             textMessage.color = Color.red;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>             textMessage.text = errorMessage;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>          Debug.LogError($"Authentication failed: {errorMessage}");</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    // Include the static GenerateSignature function here (from Headers section)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public static string GenerateSignature(byte[] body, string timestamp, string endpointPath)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        // ... (Implementation from Headers section) ...</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         byte[] hashBody;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         using (var sha256 = System.Security.Cryptography.SHA256.Create()) { hashBody = sha256.ComputeHash(body); }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         string hexHash = BitConverter.ToString(hashBody).Replace("-", "").ToLowerInvariant();</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         string signatureBase = $"POST:{endpointPath}:{hexHash}:{timestamp}";</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         using (var hmac = new System.Security.Cryptography.HMACSHA512(Encoding.UTF8.GetBytes(SignatureSecret))) {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>             byte[] signatureBytes = hmac.ComputeHash(Encoding.UTF8.GetBytes(signatureBase));</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>             return Convert.ToBase64String(signatureBytes);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>}</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>// Include C# Class Definitions here (ValidateCodeRequestDto, AuthSuccessResponse, AuthResponseData, UserData, ErrorResponse)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>// ...</span></div></pre></pre>
</li>
<li>
<p><strong>Godot C# Example:</strong> Adapt the Godot C# example similarly, using <code>System.Text.Json</code> for potentially better JSON handling (especially with nested objects and potential error structures), updating the request DTO, removing <code>X-Gamecode</code>, and parsing the new standardized success/error response formats.</p>
</li>
</ul>
<hr>
<h3 id="post-point---submit-player-points"><code>POST /point</code> - Submit Player Points</h3>
<p>Submits the player's points for the authenticated session using the <code>userPlaygroundId</code> obtained from <code>/auth</code>.</p>
<ul>
<li>
<p><strong>Headers:</strong></p>

























<table><thead><tr><th>Name</th><th>Content</th><th>Description</th></tr></thead><tbody><tr><td><code>X-Signature</code></td><td><em>Generated Signature</em></td><td>Signature generated for this request (see above)</td></tr><tr><td><code>X-Timestamp</code></td><td><em>Current Timestamp</em></td><td>Timestamp used for the signature (ISO 8601 UTC)</td></tr><tr><td><code>Content-Type</code></td><td><code>application/json</code></td><td>Specifies request body format</td></tr></tbody></table>
</li>
<li>
<p><strong>Request Body DTO (<code>SubmitPointDto</code>):</strong></p>
<ul>
<li><code>userPlaygroundId</code> (string): The ID obtained from the successful <code>/auth</code> response (<code>data.user.userPlaygroundId</code>). <strong>Required.</strong></li>
<li><code>point</code> (integer): The number of points the player scored in the session. <strong>Required.</strong></li>
</ul>
</li>
<li>
<p><strong>Request Body Example:</strong></p>
<pre><pre><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="color: rgb(171, 178, 191);">{</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>  </span><span style="color: rgb(224, 108, 117);">"userPlaygroundId"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(152, 195, 121);">"8bba8f9c-3058-4277-9e24-fc4b8f87efda"</span><span style="color: rgb(171, 178, 191);">,</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>  </span><span style="color: rgb(224, 108, 117);">"point"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(209, 154, 102);">2000</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(171, 178, 191);">}</span></div></pre></pre>
<p><em>(Note: <code>attemptId</code> is NOT sent in the request body anymore).</em></p>
</li>
<li>
<p><strong>Responses:</strong></p>
<ul>
<li>
<p><strong><code>200 OK</code></strong> (Success)</p>
<pre><pre><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="color: rgb(171, 178, 191);">{</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"success"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(209, 154, 102);">true</span><span style="color: rgb(171, 178, 191);">,</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"message"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(152, 195, 121);">"Success added points"</span><span style="color: rgb(171, 178, 191);">,</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"data"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(171, 178, 191);">{</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        </span><span style="color: rgb(224, 108, 117);">"playgroundId"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(152, 195, 121);">"8bba8f9c-3058-4277-9e24-fc4b8f87efda"</span><span style="color: rgb(171, 178, 191);">,</span><span> </span><span style="color: rgb(92, 99, 112);">// Confirms the user ID points were added to</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        </span><span style="color: rgb(224, 108, 117);">"addedPoint"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(209, 154, 102);">200</span><span> </span><span style="color: rgb(92, 99, 112);">// Actual points recorded (could potentially differ from points sent based on backend logic/caps)</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        </span><span style="color: rgb(92, 99, 112);">// attemptId is NOT returned here anymore</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(171, 178, 191);">}</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(171, 178, 191);">}</span></div></pre></pre>
</li>
<li>
<p><strong><code>400 Bad Request</code></strong> (Points already submitted for this user context, or other business logic failure)</p>
<pre><pre><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="color: rgb(171, 178, 191);">{</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"success"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(209, 154, 102);">false</span><span style="color: rgb(171, 178, 191);">,</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"message"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(152, 195, 121);">"Oops! Points may have already been submitted for this session, or the session is invalid."</span><span style="color: rgb(171, 178, 191);">,</span><span> </span><span style="color: rgb(92, 99, 112);">// Example message</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"data"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(198, 120, 221);">null</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(92, 99, 112);">// Potentially "error_code": "POINTS_ALREADY_SUBMITTED" or "INVALID_SESSION"</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(171, 178, 191);">}</span></div></pre></pre>
<p><em>(The specific error for already submitted points depends on backend logic now that <code>attemptId</code> isn't the primary key here).</em></p>
</li>
<li>
<p><strong><code>401 Unauthorized</code></strong> (Invalid Headers or Unauthorized <code>userPlaygroundId</code>)</p>
<pre><pre><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="color: rgb(171, 178, 191);">{</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"success"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(209, 154, 102);">false</span><span style="color: rgb(171, 178, 191);">,</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"message"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(152, 195, 121);">"Invalid Signature"</span><span> / </span><span style="color: rgb(152, 195, 121);">"Invalid timestamp"</span><span> / </span><span style="color: rgb(152, 195, 121);">"Unauthorized User"</span><span style="color: rgb(171, 178, 191);">,</span><span> </span><span style="color: rgb(92, 99, 112);">// Specific message may vary</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(224, 108, 117);">"data"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(198, 120, 221);">null</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>     </span><span style="color: rgb(92, 99, 112);">// Potentially "error_code": "INVALID_SIGNATURE" / "INVALID_TIMESTAMP" / "UNAUTHORIZED_USER"</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(171, 178, 191);">}</span></div></pre></pre>
</li>
<li>
<p><strong><code>422 Unprocessable Entity</code></strong> (Invalid Request Body / Missing Fields)</p>
<pre><pre><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="color: rgb(171, 178, 191);">{</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>   </span><span style="color: rgb(224, 108, 117);">"success"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(209, 154, 102);">false</span><span style="color: rgb(171, 178, 191);">,</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>   </span><span style="color: rgb(224, 108, 117);">"message"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(152, 195, 121);">"Validation failed: userPlaygroundId should not be empty, point must be a number"</span><span style="color: rgb(171, 178, 191);">,</span><span> </span><span style="color: rgb(92, 99, 112);">// Example message</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>   </span><span style="color: rgb(224, 108, 117);">"data"</span><span style="color: rgb(97, 175, 239);">:</span><span> </span><span style="color: rgb(198, 120, 221);">null</span><span style="color: rgb(171, 178, 191);">,</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    </span><span style="color: rgb(92, 99, 112);">// Potentially "error_code": "VALIDATION_ERROR", "errors": { ... }</span><span></span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span></span><span style="color: rgb(171, 178, 191);">}</span></div></pre></pre>
<p><em>(Will occur if <code>userPlaygroundId</code> or <code>point</code> are missing or invalid).</em></p>
</li>
</ul>
</li>
<li>
<p><strong>Signature Code Specifics (C# Example):</strong></p>
<pre><pre><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>// Use "/point" as the endpointPath when calling GenerateSignature</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>// Ensure bodyRaw contains the JSON with userPlaygroundId and point</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>string signature = GenerateSignature(bodyRaw, timestamp, "/point");</span></div></pre></pre>
</li>
<li>
<p><strong>Request/Response Classes (C# - Unity/Godot):</strong></p>
<pre><pre><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using System;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using System.Collections.Generic;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>// Request DTO</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>[Serializable]</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>public class SubmitPointDto</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>{</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public string userPlaygroundId;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public int point; // Changed from score, removed attemptId</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>}</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>// Success Response Structure (Root)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>[Serializable]</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>public class PointSuccessResponse</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>{</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public bool success;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public string message;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public PointResponseData data;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>}</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>// Data part of the Success Response</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>[Serializable]</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>public class PointResponseData</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>{</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public string playgroundId;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public int addedPoint; // Assuming int, adjust if it can be string/decimal</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    // attemptId removed</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>}</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>// Can reuse the general ErrorResponse class from /auth section for error handling</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>// [Serializable] public class ErrorResponse { ... }</span></div></pre></pre>
</li>
<li>
<p><strong>Request Example (Unity C# - <code>IEnumerator</code> - Updated):</strong></p>
<pre><pre><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using UnityEngine;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using UnityEngine.Networking;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using System.Collections;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using System.Text;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using System;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using TMPro;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>using UnityEngine.UI;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>public class PointSubmitter : MonoBehaviour // Renamed for clarity</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>{</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public TMP_Text scoreMessage;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public Button retryButton;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    private const string DevApiUrl = "https://quantum-games-dev.fly.dev";</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    private const string SignatureSecret = "oqtZiTK6y1S8IwmbBMWHtw=="; // Dev Secret</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    // Call this when the game ends, passing the final points</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    public void SubmitPlayerPoints(int finalPoints)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         // Get the authenticated user ID (assuming stored statically in GameAuthenticator)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         string currentUserId = GameAuthenticator.UserPlaygroundId;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         if (string.IsNullOrEmpty(currentUserId))</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>              Debug.LogError("Cannot submit points: UserPlaygroundId is missing. Was authentication successful?");</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>              if (scoreMessage != null) {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                  scoreMessage.color = Color.red;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                  scoreMessage.text = "Error: Not authenticated.";</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>              }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>              if (retryButton != null) retryButton.gameObject.SetActive(true); // Show retry even if auth failed previously</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>              return;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        StartCoroutine(SendPoints(currentUserId, finalPoints));</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    IEnumerator SendPoints(string userId, int points)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        if (scoreMessage != null)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            scoreMessage.color = Color.black;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            scoreMessage.text = "Please wait... submitting points";</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        if (retryButton != null) retryButton.gameObject.SetActive(false);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        string url = $"{DevApiUrl}/point";</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        // Use the updated Request DTO</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        SubmitPointDto request = new()</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            userPlaygroundId = userId,</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            point = points // Use 'point' field</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            // attemptId removed</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        };</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        string requestBody = JsonUtility.ToJson(request);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        byte[] bodyRaw = Encoding.UTF8.GetBytes(requestBody);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        DateTime now = DateTime.UtcNow;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        string timestamp = now.ToString("yyyy-MM-ddTHH:mm:ssZ");</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        // Ensure GenerateSignature exists and uses the correct secret/logic</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        string signature = GameAuthenticator.GenerateSignature(bodyRaw, timestamp, "/point"); // Assuming GenerateSignature is accessible</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        using (UnityWebRequest webRequest = new UnityWebRequest(url, "POST"))</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            webRequest.uploadHandler = new UploadHandlerRaw(bodyRaw);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            webRequest.downloadHandler = new DownloadHandlerBuffer();</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            webRequest.SetRequestHeader("Content-Type", "application/json");</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            // X-Gamecode removed</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            webRequest.SetRequestHeader("X-Timestamp", timestamp);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            webRequest.SetRequestHeader("X-Signature", signature);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            yield return webRequest.SendWebRequest();</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            if (webRequest.result == UnityWebRequest.Result.Success)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                 // Parse the standardized success response</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                 PointSuccessResponse response = JsonUtility.FromJson&lt;PointSuccessResponse&gt;(webRequest.downloadHandler.text);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                 if(response != null &amp;&amp; response.success &amp;&amp; response.data != null) {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                    if (scoreMessage != null)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                    {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                        scoreMessage.color = Color.black;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                        scoreMessage.text = $"{response.message}. You gained {response.data.addedPoint} point(s)!";</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                    }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                    Debug.Log($"Points submitted successfully. Points added: {response.data.addedPoint}");</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                    // Invalidate local state if necessary (e.g., prevent resubmit button press)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                    // Since attemptId is gone, you might disable the submit button or rely on server rejection</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                 } else {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                     HandlePointError(webRequest, "Unexpected success response structure");</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                 }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            else</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                 HandlePointError(webRequest);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>            }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>             // Always show retry button after attempt (success or fail)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>             if (retryButton != null) retryButton.gameObject.SetActive(true);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>        }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>     // Helper to handle errors consistently</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>     void HandlePointError(UnityWebRequest webRequest, string defaultMessage = null) {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         string errorJson = webRequest.downloadHandler.text;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         string errorMessage = defaultMessage ?? $"Error {webRequest.responseCode}";</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         try {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>              // Try parsing the standard error format (reuse ErrorResponse class)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>              ErrorResponse error = JsonUtility.FromJson&lt;ErrorResponse&gt;(errorJson);</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>               if (error != null &amp;&amp; !string.IsNullOrEmpty(error.message)) {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>                   errorMessage = error.message;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>               }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         } catch {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>             Debug.LogError($"Raw Error Response: {errorJson}");</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         if (scoreMessage != null)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         {</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>             scoreMessage.color = Color.red;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>             scoreMessage.text = errorMessage;</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>         }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>          Debug.LogError($"Point submission failed: {errorMessage}");</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>     }</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>    // Note: Assumes GameAuthenticator class with GenerateSignature and stored UserPlaygroundId exists.</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>}</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span style="display: inline-block;">
</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>// Include C# Class Definitions here (SubmitPointDto, PointSuccessResponse, PointResponseData, ErrorResponse)</span></div><div style="color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px;"><span>// ...</span></div></pre></pre>
</li>
</ul>